<!DOCTYPE html>
<html lang="zh">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>å°å®‹åŒå­¦æš‘å‡å¬è¯¾è¡¨</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: "Microsoft YaHei", sans-serif;
      background-color: #e6f4fa;
      margin: 0;
    }

    h1 {
      text-align: center;
      color: #007acc;
      margin: 20px;
    }

    nav {
      display: flex;
      justify-content: center;
      background-color: #cceeff;
      padding: 10px;
    }

    nav button {
      margin: 0 10px;
      padding: 8px 16px;
      background-color: #007acc;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }

    nav button.active {
      background-color: #005c99;
    }

    .subject-nav {
      display: flex;
      justify-content: center;
      background-color: #e0f7fa;
      padding: 10px;
      margin-bottom: 20px;
    }

    .subject-nav button {
      margin: 0 10px;
      padding: 8px 16px;
      background-color: #00acc1;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }

    .subject-nav button.active {
      background-color: #00838f;
    }

    .page {
      display: none;
      padding: 20px;
    }

    .page.active {
      display: block;
    }

    .summary {
      display: flex;
      justify-content: space-around;
      margin: 20px 0;
      font-weight: bold;
      color: #005c99;
    }

    .summary-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      min-width: 150px;
    }

    .progress-container {
      width: 100%;
      height: 10px;
      background-color: #e0e0e0;
      border-radius: 5px;
      margin-top: 5px;
    }

    .progress-bar {
      height: 100%;
      border-radius: 5px;
      transition: width 0.3s;
    }

    #video-progress {
      background-color: #4dc9f6;
    }

    #exercise-progress {
      background-color: #f67019;
    }

    #mastery-progress {
      background-color: #00ba9b;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background-color: white;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    th,
    td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: center;
    }

    th {
      background-color: #b3e0ff;
      color: #003d66;
    }

    tr:hover {
      background-color: #f1f9ff;
    }

    input[type="checkbox"] {
      transform: scale(1.2);
    }

    .difficulty {
      color: #ffcc00;
      font-size: 1.2em;
    }

    .chart-container {
      max-width: 800px;
      margin: 40px auto;
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .checkbox-cell {
      cursor: pointer;
      user-select: none;
    }

    .checkbox-cell:hover {
      background-color: #e6f7ff;
    }

    .checkbox-cell:active {
      background-color: #cceeff;
    }

    .save-notification {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: #4CAF50;
      color: white;
      padding: 10px 20px;
      border-radius: 5px;
      z-index: 1000;
      animation: fadeOut 2s forwards;
      animation-delay: 1s;
    }

    @keyframes fadeOut {
      to {
        opacity: 0;
        transform: translateY(20px);
      }
    }

    @media (max-width: 600px) {

      nav,
      .subject-nav {
        flex-direction: column;
        align-items: center;
      }

      nav button,
      .subject-nav button {
        margin: 5px 0;
        width: 90%;
      }

      .summary {
        flex-direction: column;
        align-items: center;
      }

      .summary .summary-item {
        margin: 5px 0;
        width: 100%;
      }
    }

    @media (prefers-color-scheme: dark) {
      body {
        background-color: #1a1a1a;
        color: #e0e0e0;
      }

      table {
        background-color: #2d2d2d;
        color: #e0e0e0;
      }

      th {
        background-color: #003366;
        color: #e0e0e0;
      }

      tr:hover {
        background-color: #333333;
      }

      .chart-container {
        background-color: #2d2d2d;
      }

      .checkbox-cell:hover {
        background-color: #333333;
      }

      .subject-nav {
        background-color: #004d40;
      }
    }
  </style>
</head>

<body>
  <h1>é«˜ä¸‰å¤ä¹ è‡ªæŸ¥è¡¨</h1>
  <nav>
    <button id="plan-tab" class="active" onclick="showPage('plan')">ğŸ“˜ å¤ä¹ è®¡åˆ’</button>
    <button id="stat-tab" onclick="showPage('stat')">ğŸ“Š æ•°æ®ç»Ÿè®¡</button>
  </nav>

  <div id="plan" class="page active">
    <div class="subject-nav">
      <button id="chem-subject" class="active" onclick="showSubject('chem')">åŒ–å­¦</button>
      <button id="phy-subject" onclick="showSubject('phy')">ç‰©ç†</button>
    </div>

    <div id="chem-content" class="subject-content">
      <div class="summary">
        <div class="summary-item">
          <div id="chem-video-summary">è§†é¢‘å®Œæˆ: åŠ è½½ä¸­...</div>
          <div class="progress-container">
            <div class="progress-bar" id="chem-video-progress"></div>
          </div>
        </div>
        <div class="summary-item">
          <div id="chem-exercise-summary">é¢˜é¢˜å®Œæˆ: åŠ è½½ä¸­...</div>
          <div class="progress-container">
            <div class="progress-bar" id="chem-exercise-progress"></div>
          </div>
        </div>
        <div class="summary-item">
          <div id="chem-mastery-summary">æŒæ¡æƒ…å†µ: åŠ è½½ä¸­...</div>
          <div class="progress-container">
            <div class="progress-bar" id="chem-mastery-progress"></div>
          </div>
        </div>
      </div>
      <table>
        <thead>
          <tr>
            <th>åºå·</th>
            <th>çŸ¥è¯†è§†é¢‘</th>
            <th>è§†é¢‘å®Œæˆ</th>
            <th>é¢˜é¢˜å®Œæˆ</th>
            <th>æŒæ¡æƒ…å†µ</th>
          </tr>
        </thead>
        <tbody id="chem-table-body"></tbody>
      </table>
    </div>

    <div id="phy-content" class="subject-content" style="display:none;">
      <div class="summary">
        <div class="summary-item">
          <div id="phy-video-summary">è§†é¢‘å®Œæˆ: åŠ è½½ä¸­...</div>
          <div class="progress-container">
            <div class="progress-bar" id="phy-video-progress"></div>
          </div>
        </div>
        <div class="summary-item">
          <div id="phy-exercise-summary">é¢˜é¢˜å®Œæˆ: åŠ è½½ä¸­...</div>
          <div class="progress-container">
            <div class="progress-bar" id="phy-exercise-progress"></div>
          </div>
        </div>
        <div class="summary-item">
          <div id="phy-mastery-summary">æŒæ¡æƒ…å†µ: åŠ è½½ä¸­...</div>
          <div class="progress-container">
            <div class="progress-bar" id="phy-mastery-progress"></div>
          </div>
        </div>
      </div>
      <table>
        <thead>
          <tr>
            <th>åºå·</th>
            <th>çŸ¥è¯†è§†é¢‘</th>
            <th>è§†é¢‘å®Œæˆ</th>
            <th>é¢˜é¢˜å®Œæˆ</th>
            <th>æŒæ¡æƒ…å†µ</th>
          </tr>
        </thead>
        <tbody id="phy-table-body"></tbody>
      </table>
    </div>
  </div>

  <div id="stat" class="page">
    <div class="subject-nav">
      <button id="chem-stat-tab" class="active" onclick="showStatSubject('chem')">åŒ–å­¦ç»Ÿè®¡</button>
      <button id="phy-stat-tab" onclick="showStatSubject('phy')">ç‰©ç†ç»Ÿè®¡</button>
    </div>

    <div id="chem-stat" class="stat-content">
      <div class="chart-container">
        <canvas id="chem-pieChart"></canvas>
      </div>
      <div class="chart-container">
        <canvas id="chem-barChart"></canvas>
      </div>
    </div>

    <div id="phy-stat" class="stat-content" style="display:none;">
      <div class="chart-container">
        <canvas id="phy-pieChart"></canvas>
      </div>
      <div class="chart-container">
        <canvas id="phy-barChart"></canvas>
      </div>
    </div>
  </div>

  <script>
    function showPage(name) {
      document.querySelectorAll(".page").forEach(p => p.classList.remove("active"));
      document.querySelectorAll("nav button").forEach(b => b.classList.remove("active"));
      document.getElementById(name).classList.add("active");
      document.getElementById(name + "-tab").classList.add("active");
    }

    function showSubject(name) {
      document.querySelectorAll(".subject-content").forEach(p => p.style.display = "none");
      document.querySelectorAll(".subject-nav button").forEach(b => b.classList.remove("active"));
      document.getElementById(name + "-content").style.display = "block";
      document.getElementById(name + "-subject").classList.add("active");
    }

    function showStatSubject(name) {
      document.querySelectorAll(".stat-content").forEach(p => p.style.display = "none");
      document.querySelectorAll(".subject-nav button").forEach(b => b.classList.remove("active"));
      document.getElementById(name + "-stat").style.display = "block";
      document.getElementById(name + "-stat-tab").classList.add("active");
    }

    const chemData = [
      { id: 1, title: "1.1.4.1 æ°§åŒ–è¿˜åŸååº”çš„æ ¸å¿ƒæ¦‚å¿µ" },
      { id: 2, title: "1.1.4.4 æ°§åŒ–æ€§è¿˜åŸæ€§ã€å¾—å¤±ç”µå­å®ˆæ’è®¡ç®—" },
      { id: 3, title: "1.1.4.2 æ°§åŒ–è¿˜åŸæ–¹ç¨‹å¼åŸºç¡€é…å¹³" },
      { id: 4, title: "1.1.4.3 æ°§åŒ–è¿˜åŸæ–¹ç¨‹å¼è¿›é˜¶é…å¹³" },
      { id: 5, title: "1.2.1.1 å…ƒç´ åŒ–åˆç‰©å­¦æ³•ã€é‡‘å±éé‡‘å±é€šæ€§" },
      { id: 6, title: "1.2.2.1 é’ å…ƒç´ æ€§è´¨æ€»è¿°" },
      { id: 7, title: "1.2.2.2 è¿‡æ°§åŒ–é’ æ€§è´¨è¯¦è§£" },
      { id: 8, title: "1.2.2.4 é“å…ƒç´ æ€§è´¨æ€»è¿°" },
      { id: 9, title: "1.2.2.6 é“å…ƒç´ æ€§è´¨æ€»è¿°" },
      { id: 10, title: "1.2.2.7 é“ç›çš„è½¬åŒ–ã€é“ç¦»å­æ£€éªŒ" },
      { id: 11, title: "1.2.2.8 é•ã€é“œå…ƒç´ æ€§è´¨æ€»è¿°" },
      { id: 12, title: "1.2.3.1 æ°¯å…ƒç´ æ€§è´¨æ€»è¿°" },
      { id: 13, title: "1.2.3.3 ç¡«å…ƒç´ æ€§è´¨æ€»è¿°" },
      { id: 14, title: "1.2.3.4 äºŒæ°§åŒ–ç¡«æ€§è´¨ç²¾è®²" },
      { id: 15, title: "1.2.3.6 æ°®æ°”ã€æ°¨æ°”å’Œé“µç›" },
      { id: 16, title: "1.2.2.3 ç¢³é…¸é’ ã€ç¢³é…¸æ°¢é’ æ€§è´¨è¯¦è§£" },
      { id: 17, title: "1.2.2.5 é“å…ƒç´ å®éªŒåŠå·¥ä¸šæµç¨‹" },
      { id: 18, title: "1.2.3.2 å¤æ—å…ƒç´ " },
      { id: 19, title: "1.2.3.5 ç¡«é…¸ã€ç¡«åŒ–ç‰©å’Œç¡«ä»£ç¡«é…¸ç›ç­‰" },
      { id: 20, title: "1.1.1.1 ç‰©è´¨çš„åˆ†ç±»â€”â€”é…¸ç¢±ç›" },
      { id: 21, title: "1.1.1.2 ç‰©è´¨çš„åˆ†ç±»è¿›é˜¶ã€èƒ¶ä½“åˆ†æ•£ç³»" },
      { id: 22, title: "1.1.3.1 ç¦»å­ååº”ä¸ç¦»å­æ–¹ç¨‹å¼åŸºæœ¬ä¹¦å†™" },
      { id: 23, title: "1.1.3.2 ç¦»å­å…±å­˜" },
      { id: 24, title: "1.1.2.1 åŒ–å­¦è®¡é‡åŸºæœ¬æ¦‚å¿µ" },
      { id: 25, title: "1.1.2.2 é˜¿ä¼åŠ å¾·ç½—å¸¸æ•°ç›¸å…³æ­£è¯¯åˆ¤æ–­" },
      { id: 26, title: "1.2.3.8 ç¡…å…ƒç´ åŠå…¶åŒ–åˆç‰©" },
      { id: 27, title: "1.3.1.1 ååº”çƒ­ã€ç„“å˜ä¸çƒ­åŒ–å­¦æ–¹ç¨‹å¼ä¹¦å†™" },
      { id: 28, title: "1.3.1.2 ç‡ƒçƒ§çƒ­å’Œç›–æ–¯å®šå¾‹" },
      { id: 29, title: "1.3.2.1 åŒ–å­¦ååº”é€Ÿç‡çš„å®šä¹‰åŠè®¡ç®—" },
      { id: 30, title: "1.3.2.2 åŒ–å­¦ååº”é€Ÿç‡çš„å½±å“å› ç´ " },
      { id: 31, title: "1.3.3.1 åŒ–å­¦å¹³è¡¡çŠ¶æ€çš„åˆ¤å®š" },
      { id: 32, title: "1.3.3.2 å½±å“å¹³è¡¡ç§»åŠ¨çš„å› ç´ " },
      { id: 33, title: "1.3.6.1 åŸºæœ¬ç”µæ± è£…ç½®å’Œåº”ç”¨" },
      { id: 34, title: "1.3.6.2 ç”µæä¸ºç¨‹å¼ä¹¦å†™" },
      { id: 35, title: "1.3.6.3 æ–°å‹ç”µæ± è£…ç½®ç²¾è®²" },
      { id: 36, title: "1.4.1.3 è„‚è‚ªçƒƒ" },
      { id: 37, title: "1.4.1.4 èŠ³é¦™çƒƒä¸å¤ä»£çƒƒ" },
      { id: 38, title: "1.4.1.5 é†‡å’Œé…š" },
      { id: 39, title: "1.4.1.7 é…¸ã€é…¯å’Œé…°èƒº" },
      { id: 40, title: "1.4.2.1 åŸå­ç»“æ„ã€åŒä½ç´ åŠåŠå¾„å¤§å°æ¯”è¾ƒ" },
      { id: 41, title: "1.4.2.2 åŸå­æ ¸å¤–ç”µå­æ’å¸ƒ" },
      { id: 42, title: "1.4.2.3 ç”µç¦»èƒ½ã€ç”µè´Ÿæ€§å’Œå…ƒç´ å‘¨æœŸå¾‹" },
      { id: 43, title: "1.4.2.5 VSEPRä¸æ‚åŒ–è½¨é“ç†è®º" },
      { id: 44, title: "1.4.2.9 æ™¶ä½“ç±»å‹ã€ç†”æ²¸ç‚¹" }
    ];

    const phyData =
      [
        { id: 1, title: "1.2.1.1 é‡åŠ›ã€å¼¹åŠ›å’Œæ‘©æ“¦åŠ›" },
        { id: 2, title: "1.2.2.1 åŠ›çš„åˆæˆå’Œåˆ†è§£" },
        { id: 3, title: "1.2.3.1 å•ç‰©ä½“åŠ¨æ€å¹³è¡¡é—®é¢˜" },
        { id: 4, title: "1.2.3.2 å¤šç‰©ä½“å¹³è¡¡é—®é¢˜" },
        { id: 5, title: "1.3.2.3 æ–œé¢åŠ¨åŠ›å­¦é—®é¢˜" },
        { id: 6, title: "1.3.1.1 ç‰›é¡¿è¿åŠ¨å®šå¾‹ä¸å›½é™…å•ä½åˆ¶" },
        { id: 7, title: "1.3.2.1 è¶…é‡ä¸å¤±é‡é—®é¢˜" },
        { id: 8, title: "1.3.2.2 å€¾æ–œå¼¹åŠ›åŠ¨åŠ›å­¦é—®é¢˜" },
        { id: 9, title: "1.3.2.6 æ°´å¹³ä¼ é€å¸¦åŠ¨åŠ›å­¦é—®é¢˜" },
        { id: 10, title: "1.3.2.4 å¼¹ç°§åŠ¨åŠ›å­¦å¸¸è§„é—®é¢˜" },
        { id: 11, title: "1.3.3.2 æ¿å—åŠ¨åŠ›å­¦é—®é¢˜" },
        { id: 12, title: "1.3.3.1 ç³»ç»Ÿç‰›é¡¿ç¬¬äºŒå®šå¾‹é—®é¢˜" },
        { id: 13, title: "1.4.1.1 è¿åŠ¨çš„åˆæˆä¸åˆ†è§£" },
        { id: 14, title: "1.4.2.1 å¹³æŠ›è¿åŠ¨å…¬å¼" },
        { id: 15, title: "1.4.2.2 æ–œé¢å¹³æŠ›é—®é¢˜" },
        { id: 16, title: "1.5.1.1 åœ†å‘¨è¿åŠ¨ç‰©ç†é‡ä¸ä¼ åŠ¨é—®é¢˜" },
        { id: 17, title: "1.5.2.1 æ°´å¹³åœ†å‘¨è¿åŠ¨ä¹‹æ‘©æ“¦åŠ›é—®é¢˜" },
        { id: 18, title: "1.5.2.2 æ°´å¹³åœ†å‘¨è¿åŠ¨ä¹‹æ–œå¼¹åŠ›é—®é¢˜" },
        { id: 19, title: "1.6.1.1 å¼€æ™®å‹’å®šå¾‹ä¸ä¸‡æœ‰å¼•åŠ›å®šå¾‹" },
        { id: 20, title: "1.6.2.1 å«æ˜Ÿç¯ç»•é—®é¢˜" },
        { id: 21, title: "1.6.2.2 åœ°è¡¨é‡åŠ›é—®é¢˜" },
        { id: 22, title: "1.6.2.3 å¤©ä½“è´¨é‡ä¸å¯†åº¦é—®é¢˜" },
        { id: 23, title: "1.6.2.4 å¤šæ˜Ÿé—®é¢˜" }

      ];

    function showSaveNotification() {
      const saveMsg = document.createElement('div');
      saveMsg.className = 'save-notification';
      saveMsg.textContent = 'è¿›åº¦å·²ä¿å­˜';
      document.body.appendChild(saveMsg);
      setTimeout(() => saveMsg.remove(), 3000);
    }

    function saveProgress(subject) {
      const rows = [...document.querySelectorAll(`#${subject}-table-body tr`)];
      const progress = rows.map(row => [...row.querySelectorAll("input")].map(i => i.checked));
      localStorage.setItem(`${subject}_progress`, JSON.stringify(progress));
      showSaveNotification();
    }

    function loadProgress(subject) {
      const saved = JSON.parse(localStorage.getItem(`${subject}_progress`) || "[]");
      const rows = [...document.querySelectorAll(`#${subject}-table-body tr`)];
      rows.forEach((row, i) => {
        if (saved[i]) {
          const inputs = row.querySelectorAll("input");
          inputs.forEach((input, j) => input.checked = saved[i][j]);
        }
      });
      updateSummary(subject);
    }

    function updateDailyLog(subject) {
      const today = new Date().toISOString().slice(0, 10);
      let log = JSON.parse(localStorage.getItem(`${subject}_daily_log`) || "{}");
      const rows = [...document.querySelectorAll(`#${subject}-table-body tr`)];
      let count = 0;
      rows.forEach(row => {
        row.querySelectorAll("input").forEach(input => {
          if (input.checked) count++;
        });
      });
      log[today] = count;
      localStorage.setItem(`${subject}_daily_log`, JSON.stringify(log));
      updateBarChart(subject);
    }

    function updateSummary(subject) {
      const rows = [...document.querySelectorAll(`#${subject}-table-body tr`)];
      let videoDone = 0, exerciseDone = 0, masteryDone = 0;
      const total = subject === 'chem' ? 44 : 23;

      rows.forEach(row => {
        const inputs = row.querySelectorAll("input");
        if (inputs[0].checked) videoDone++;
        if (inputs[1].checked) exerciseDone++;
        if (inputs[2].checked) masteryDone++;
      });

      const videoPercent = (videoDone / total * 100).toFixed(1);
      const exercisePercent = (exerciseDone / total * 100).toFixed(1);
      const masteryPercent = (masteryDone / total * 100).toFixed(1);

      document.getElementById(`${subject}-video-summary`).textContent = `è§†é¢‘å®Œæˆ: ${videoDone}/${total} (${videoPercent}%)`;
      document.getElementById(`${subject}-exercise-summary`).textContent = `é¢˜é¢˜å®Œæˆ: ${exerciseDone}/${total} (${exercisePercent}%)`;
      document.getElementById(`${subject}-mastery-summary`).textContent = `æŒæ¡æƒ…å†µ: ${masteryDone}/${total} (${masteryPercent}%)`;

      document.getElementById(`${subject}-video-progress`).style.width = `${videoPercent}%`;
      document.getElementById(`${subject}-exercise-progress`).style.width = `${exercisePercent}%`;
      document.getElementById(`${subject}-mastery-progress`).style.width = `${masteryPercent}%`;

      const pieChart = window[`${subject}PieChart`];
      pieChart.data.datasets[0].data = [videoDone, exerciseDone, masteryDone, total * 3 - (videoDone + exerciseDone + masteryDone)];
      pieChart.update();
      saveProgress(subject);
      updateDailyLog(subject);
    }

    // åˆå§‹åŒ–åŒ–å­¦è¡¨æ ¼
    chemData.forEach(item => {
      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${item.id}</td>
        <td>${item.title}</td>
        <td class="checkbox-cell"><input type="checkbox" onchange="updateSummary('chem')"></td>
        <td class="checkbox-cell"><input type="checkbox" onchange="updateSummary('chem')"></td>
        <td class="checkbox-cell"><input type="checkbox" onchange="updateSummary('chem')"></td>
      `;
      document.getElementById("chem-table-body").appendChild(row);
    });

    // åˆå§‹åŒ–ç‰©ç†è¡¨æ ¼
    phyData.forEach(item => {
      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${item.id}</td>
        <td>${item.title}</td>
        <td class="checkbox-cell"><input type="checkbox" onchange="updateSummary('phy')"></td>
        <td class="checkbox-cell"><input type="checkbox" onchange="updateSummary('phy')"></td>
        <td class="checkbox-cell"><input type="checkbox" onchange="updateSummary('phy')"></td>
      `;
      document.getElementById("phy-table-body").appendChild(row);
    });

    // æ·»åŠ ç‚¹å‡»å•å…ƒæ ¼åˆ‡æ¢å¤é€‰æ¡†çš„åŠŸèƒ½
    document.addEventListener('DOMContentLoaded', function () {
      document.querySelectorAll('.checkbox-cell').forEach(cell => {
        cell.addEventListener('click', function (e) {
          if (e.target.tagName !== 'INPUT') {
            const checkbox = this.querySelector('input');
            if (checkbox) {
              checkbox.checked = !checkbox.checked;
              const subject = this.closest('.subject-content').id.split('-')[0];
              updateSummary(subject);
            }
          }
        });
      });
    });

    // æ·»åŠ é”®ç›˜å¯¼èˆªæ”¯æŒ
    document.addEventListener('keydown', function (e) {
      if (e.key === 'ArrowUp' || e.key === 'ArrowDown') {
        const activeSubject = document.querySelector('.subject-content[style="display: block;"]') ||
          document.querySelector('.subject-content:not([style])');
        if (!activeSubject) return;

        const rows = [...activeSubject.querySelectorAll('tbody tr')];
        const current = document.activeElement.closest('tr');
        let index = rows.indexOf(current);

        if (index >= 0) {
          if (e.key === 'ArrowUp' && index > 0) index--;
          if (e.key === 'ArrowDown' && index < rows.length - 1) index++;

          const cells = rows[index].querySelectorAll('.checkbox-cell');
          if (cells.length > 0) cells[0].focus();
        }
      } else if (e.key === 'Enter' && document.activeElement.classList.contains('checkbox-cell')) {
        const checkbox = document.activeElement.querySelector('input');
        if (checkbox) {
          checkbox.checked = !checkbox.checked;
          const subject = document.activeElement.closest('.subject-content').id.split('-')[0];
          updateSummary(subject);
        }
      }
    });

    // åˆå§‹åŒ–åŒ–å­¦å›¾è¡¨
    const chemPieCtx = document.getElementById('chem-pieChart').getContext('2d');
    window.chemPieChart = new Chart(chemPieCtx, {
      type: 'pie',
      data: {
        labels: ['è§†é¢‘å®Œæˆ', 'é¢˜é¢˜å®Œæˆ', 'æŒæ¡æƒ…å†µ', 'æœªå®Œæˆ'],
        datasets: [{
          data: [0, 0, 0, 132],
          backgroundColor: ['#4dc9f6', '#f67019', '#00ba9b', '#ccc'],
        }]
      },
      options: {
        responsive: true,
        plugins: { legend: { position: 'bottom' } }
      }
    });

    // åˆå§‹åŒ–ç‰©ç†å›¾è¡¨
    const phyPieCtx = document.getElementById('phy-pieChart').getContext('2d');
    window.phyPieChart = new Chart(phyPieCtx, {
      type: 'pie',
      data: {
        labels: ['è§†é¢‘å®Œæˆ', 'é¢˜é¢˜å®Œæˆ', 'æŒæ¡æƒ…å†µ', 'æœªå®Œæˆ'],
        datasets: [{
          data: [0, 0, 0, 105],
          backgroundColor: ['#4dc9f6', '#f67019', '#00ba9b', '#ccc'],
        }]
      },
      options: {
        responsive: true,
        plugins: { legend: { position: 'bottom' } }
      }
    });

    let chemBarChart, phyBarChart;
    function updateBarChart(subject) {
      const ctx = document.getElementById(`${subject}-barChart`).getContext('2d');
      const log = JSON.parse(localStorage.getItem(`${subject}_daily_log`) || "{}");
      const dates = Object.keys(log).slice(-7);
      const counts = dates.map(d => log[d]);

      if (window[`${subject}BarChart`]) window[`${subject}BarChart`].destroy();
      window[`${subject}BarChart`] = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: dates,
          datasets: [{
            label: 'æ¯æ—¥å®Œæˆæ‰“å¡',
            data: counts,
            backgroundColor: '#4dc9f6',
          }]
        },
        options: {
          responsive: true,
          scales: { y: { beginAtZero: true, stepSize: 1 } }
        }
      });
    }

    // åˆå§‹åŠ è½½
    loadProgress('chem');
    loadProgress('phy');
    updateBarChart('chem');
    updateBarChart('phy');
  </script>
</body>

</html>